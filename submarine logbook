#include <cstdio>
#include <cstdlib>
#include <ctime>
#include <string.h>
#include <locale.h>

int nrecords;

void numStrings()
{
    int count=6;
    char array[401];
    FILE *in;
    in=fopen("x.txt","r");
    if (in == NULL)
    {
        perror("Error opening file x.txt\n");
    }
    else
    {
        while (!feof(in))
        {

            if (fgets(array, 400, in) != NULL)
            {
                nrecords++;
            }
        }
    }
    fclose(in);
}


void showJournal()
{
    printf("--------------------------\n");
    printf("   Logbook:\n");
    printf("--------------------------\n");
    int count=0;
    char array[401];
    FILE *in;
    in=fopen("x.txt","r");
    if (in == NULL)
    {
        perror("Error opening file x.txt\n");
    }
    else
    {
        while (!feof(in))
        {
            if (fgets(array, 400, in) != NULL)
            {
                count++;
                printf(" %s",array);
            }
            else
            {
                if(count==0)
                {
                    printf("\n   No records\n");
                }
            }
        }
    }
    fclose(in);
}


void addMessage ()
{
    nrecords+=3;
    printf("--------------------------\n");
    printf("   New record:\n");
    printf("--------------------------\n");
    FILE *in;
    char array[401];
    fgets (array,400,stdin);
    time_t timer = time(NULL);
    in = fopen ("x.txt","a");
    fprintf (in, "%d. %s   %s\n",nrecords/3,ctime(&timer),array);
    fclose (in);
}


void deleteMessage()
{
    printf("not ready\n");
}


int main()
{
    numStrings();
    FILE *in;
    in=fopen("x.txt","r");
    char array[200];
    if (in == NULL) perror("Error opening file");
    setlocale( LC_ALL, "rus" );
    while(1)
    {
        printf("\n--------------------------\n");
        printf("1. Show logbook\n2. Add message\n3. Delete message\n0. Exit\n\nEnter value from 0 to 3\n");
        char choice[100];
        fgets(choice, 99, stdin);
        int ch;
        ch = -1;
        sscanf(choice, "%d", &ch);
        switch(ch)
        {
        case 0:
            return 0;
        case 1:
            showJournal();
            break;
        case 2:
            addMessage ();
            break;
        case 3:
            deleteMessage();
            break;
        }
    }
    return 0;
}
